\chapter{Controller design}\label{ch:Controller}
In the previous chapter a model for the segway was derived. This is used to design a controller, that makes the segway able to balance when standing still and when driving. \\
A controller design will be made upon the model's transfer function in relation to requirements set for the entire system in \autoref{requirements}. This chapter contains analysis of the model and controller design based on the analysis. Afterwards the controller in relation to the system is analyzed to validate wether or not it meets the requirements. When a controller has been designed and validated, it will be implemented in the software and lastly tested in the segway.\newpar
The requirements are:
\begin{itemize}
\item Steady state error: < $\pm$ 1\%
\item Rise time: <1 s
\item Settling time: < 3 s
\item Overshoot: < 5 \%
\end{itemize}
\section{Model analysis}
The bode plot of the segways transfer function is shown in \autoref{fig:segwayBode_Merge}.
\begin{figure}[H]
    \centering
    \includegraphics[width = 0.8\textwidth]{bodeSegwayMerged.eps}
    \caption{Bode plot of the transfer function for the segway.}
    \label{fig:segwayBode_Merge}
\end{figure} 
The zero in the origin of the complex plane causes the hump in the magnitude plot as well as the initial 90$\degree$ phase shift. The magnitude never crosses 0 dB and the phase is asymptotic to -180$\degree$, thus both the GM and PM is infinite. This would normally mean that the system is stable, however a closer analysis of the poles, shows that there is a pole in the right half of the s-domain. Thus the system is unstable, as expected.\newpar
Now that the combined transfer function has been determined, it needs to be verified through comparison with test results.
-Poles and zeros. 
-System type
- Stable not stable? 
- Bodeplot 
- What shall be changed? 
\section{Designing controller}





%As previous mentioned the microcontroller used for the segway is a CrumbX128A3. The microcontroller forms the center of the system, since all models and control systems are implemented here. In this chapter the system controller is analysed and is divided into following sections:
%\begin{itemize}
%\item Implementation of the models
%\item Communication with remote controller
%\end{itemize}
%
%\input{design/hal-functions.tex}